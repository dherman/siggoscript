var pre = require('./pre.js'),
    fs = require('fs');

// function test() {
// }

// var testEnv = [
//     "let false = ![], true = !false;",
//     "let 0 = _N(false), 1 = _N(true), 2 = 1+1, 3 = 2+1, 4 = 3+1;",
//     "let \"0\" = _S(0), \"1\" = _S(1), \"2\" = _S(2), \"3\" = _S(3), \"4\" = _S(4);",
//     "let \"f\" = _S(false)[0], \"a\" = _S(false)[1], \"l\" = _S(false)[2], \"s\" = _S(false)[3], \"e\" = _S(false)[4];",
//     "let \"\" = _S([]);",
//     "let undefined = [][\"\"];",
//     "let \"u\" = _S(undefined)[0], \"n\" = _S(undefined)[1];"
// ].join("\n");

// test("3", "!![]+!![]+!![]");
// test("\"3\"", "!![]+!![]+!![]+[]");
// test("[\"3\"]", "![!![]+!![]+!![]+[]]");
// test("[][\"3\"]", "![!![]+!![]+!![]]");
// test("[][3]", "![!![]+!![]+!![]]");
// test("21", "!+!![]+!![]+[]+(+!![])");
// test("\"s\"", "!((![]+[])[!![]+!![]+!![]])");
// test("\"sa\"", "!((![]+[])[!![]+!![]+!![]]+(![]+[])[+!![]])");
// test("\"saf\"", "!((![]+[])[!![]+!![]+!![]]+(![]+[])[+!![]]+(![]+[])[+![]])");
// test("\"safe\"", "!((![]+[])[!![]+!![]+!![]]+(![]+[])[+!![]]+(![]+[])[+![]]+(![]+[])[!![]+!![]+!![]+!![]])");
// test("\"e1\"", "!((!![]+[])[!![]+!![]+!![]]+(+!![]))");
// test("\"e2\"", "!((!![]+[])[!![]+!![]+!![]]+(!![]+!![]))");
// test("\"1e1000\"", "!(+!![]+(!![]+[])[!![]+!![]+!![]]+(+!![])+(+![])+(+![])+(+![]))");
// test("Infinity", "!(+(+!![]+(!![]+[])[!![]+!![]+!![]]+(+!![])+(+![])+(+![])+(+![])))");
// test("\"I\"", "!((+(+!![]+(!![]+[])[!![]+!![]+!![]]+(+!![])+(+![])+(+![])+(+![]))+[])[+![]])");
// test("\"Ireland\"", "!((+(+!![]+(!![]+[])[!![]+!![]+!![]]+(+!![])+(+![])+(+![])+(+![]))+[])[+![]]+(!![]+[])[+!![]]+(!![]+[])[!![]+!![]+!![]]+(![]+[])[!![]+!![]]+(![]+[])[+!![]]+([][[]]+[])[+!![]]+([][[]]+[])[!![]+!![]])");

if (process.argv.length < 3) {
    console.log("usage: node build.js infile");
    console.log("  infile  prelude generation script");
    process.exit();
}

var infile = fs.readFileSync(process.argv[2], 'utf8');

pre(infile, process.stdout);
